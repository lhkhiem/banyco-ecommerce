"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[653],{1971:function(e,t,r){r.d(t,{f8:function(){return d},kG:function(){return l},uD:function(){return p}}),r(257);let a="/api",o=e=>e?e.replace(/\/+$/,""):"",s=e=>e?e.startsWith("/")?e:"/".concat(e):"",n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=o(e);return t?"".concat(r).concat(s(t)):r},c=()=>{let e=o("https://ecommerce-api.banyco.vn/api");if(e)return e.endsWith("/api")?e:n(e,a);let t="ecommerce-api.banyco.vn";if(t){let e=window.location.protocol;return"".concat(e,"//").concat(t).concat(a)}{let{protocol:e,hostname:t}=window.location;return n("".concat(e,"//").concat(t).concat(":".concat("443")),a)}},i=e=>o(e).replace(/\/api$/,""),l=()=>c(),u=()=>i(c()),d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return n(c(),e)},p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return n(u(),e)}},3414:function(e,t,r){r.d(t,{gF:function(){return l},kS:function(){return i},x4:function(){return n},z2:function(){return c}});var a=r(3405),o=r(2780);let s=e=>{if(e.firstName||e.lastName)return{firstName:e.firstName||"",lastName:e.lastName||""};if(e.name){let t=e.name.trim().split(/\s+/);if(t.length>=2)return{lastName:t[0],firstName:t.slice(1).join(" ")};if(1===t.length)return{firstName:t[0],lastName:""}}return{firstName:"",lastName:""}},n=async e=>{try{let t=await a.Z.post(o.P.AUTH.LOGIN,e),r=t.data.data.user;if(r.name&&!r.firstName&&!r.lastName){let{firstName:e,lastName:a}=s(r);t.data.data.user={...t.data.data.user,firstName:e,lastName:a},console.warn('[login] ⚠️ Backend should return "firstName" and "lastName" instead of "name" for consistency')}return t.data.data}catch(e){var t,r,n,c,i,l;throw console.error("[login] Login error details:",{message:null==e?void 0:e.message,response:null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.data,status:null==e?void 0:null===(r=e.response)||void 0===r?void 0:r.status,url:null==e?void 0:null===(n=e.config)||void 0===n?void 0:n.url,baseURL:null==e?void 0:null===(c=e.config)||void 0===c?void 0:c.baseURL,fullURL:(null==e?void 0:null===(i=e.config)||void 0===i?void 0:i.baseURL)+(null==e?void 0:null===(l=e.config)||void 0===l?void 0:l.url)}),e}},c=async e=>{try{let t=await a.Z.post(o.P.AUTH.REGISTER,{email:e.email,password:e.password,firstName:e.firstName,lastName:e.lastName,phone:e.phone||void 0}),r=t.data.data.user;if(r.name&&!r.firstName&&!r.lastName){let{firstName:e,lastName:a}=s(r);t.data.data.user={...t.data.data.user,firstName:e,lastName:a},console.warn('[register] ⚠️ Backend should return "firstName" and "lastName" instead of "name" for consistency')}return t.data.data}catch(e){var t,r,n,c,i,l;throw console.error("[register] Register error details:",{message:null==e?void 0:e.message,response:null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.data,status:null==e?void 0:null===(r=e.response)||void 0===r?void 0:r.status,url:null==e?void 0:null===(n=e.config)||void 0===n?void 0:n.url,baseURL:null==e?void 0:null===(c=e.config)||void 0===c?void 0:c.baseURL,fullURL:(null==e?void 0:null===(i=e.config)||void 0===i?void 0:i.baseURL)+(null==e?void 0:null===(l=e.config)||void 0===l?void 0:l.url)}),e}},i=async()=>{try{await a.Z.post(o.P.AUTH.LOGOUT)}catch(e){console.error("Logout error:",e)}},l=async e=>{await a.Z.post(o.P.AUTH.FORGOT_PASSWORD,{email:e})}},3405:function(e,t,r){r.d(t,{z:function(){return n}});var a=r(3464),o=r(1971);let s=a.Z.create({baseURL:(0,o.kG)(),timeout:3e4,headers:{"Content-Type":"application/json"}});function n(e){if(a.Z.isAxiosError(e)){if(e.response){let t=e.response.data;return(null==t?void 0:t.code)==="INSUFFICIENT_STOCK"?'Sản phẩm "'.concat(t.productName,'" kh\xf4ng đủ số lượng. C\xf2n lại: ').concat(t.availableStock,", Bạn y\xeau cầu: ").concat(t.requestedQuantity):(null==t?void 0:t.error)||(null==t?void 0:t.message)||"Đ\xe3 xảy ra lỗi khi xử l\xfd y\xeau cầu"}if(e.request)return"Kh\xf4ng c\xf3 phản hồi từ server. Vui l\xf2ng kiểm tra kết nối của bạn."}return"Đ\xe3 xảy ra lỗi kh\xf4ng mong muốn"}s.interceptors.request.use(e=>{{let t=localStorage.getItem("accessToken");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!r._retry){r._retry=!0;try{let e=localStorage.getItem("refreshToken");if(e){let{accessToken:t}=(await a.Z.post("".concat((0,o.kG)(),"/public/auth/refresh"),{refreshToken:e})).data.data;return localStorage.setItem("accessToken",t),r.headers&&(r.headers.Authorization="Bearer ".concat(t)),s(r)}}catch(e){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login",Promise.reject(e)}}return Promise.reject(e)}),t.Z=s},2780:function(e,t,r){r.d(t,{P:function(){return a}});let a={AUTH:{LOGIN:"/auth/login",REGISTER:"/auth/register",LOGOUT:"/auth/logout",REFRESH:"/auth/refresh",VERIFY_EMAIL:"/auth/verify-email",FORGOT_PASSWORD:"/auth/forgot-password",RESET_PASSWORD:"/auth/reset-password",ME:"/auth/me"},PRODUCTS:{LIST:"/products",DETAIL:e=>"/products/".concat(e),SEARCH:"/products/search",FEATURED:"/products/featured",BEST_SELLERS:"/products/best-sellers",NEW_ARRIVALS:"/products/new-arrivals",RELATED:e=>"/products/".concat(e,"/related"),REVIEWS:e=>"/products/".concat(e,"/reviews")},CATEGORIES:{LIST:"/product-categories",DETAIL:e=>"/product-categories/slug/".concat(e),TREE:"/product-categories/tree",PRODUCTS:e=>"/product-categories/".concat(e,"/products")},BRANDS:{LIST:"/brands",DETAIL:e=>"/brands/slug/".concat(e),PRODUCTS:e=>"/brands/".concat(e,"/products")},CART:{GET:"/public/cart",ADD:"/public/cart/add",UPDATE:"/public/cart/update",REMOVE:"/public/cart/remove",CLEAR:"/public/cart/clear",APPLY_PROMO:"/public/cart/promo"},ORDERS:{LIST:"/public/orders",DETAIL:e=>"/public/orders/".concat(e),CREATE:"/orders",CANCEL:e=>"/public/orders/".concat(e,"/cancel")},USER:{PROFILE:"/public/user/profile",UPDATE_PROFILE:"/public/user/profile",ADDRESSES:"/public/user/addresses",ADD_ADDRESS:"/public/user/addresses",UPDATE_ADDRESS:e=>"/public/user/addresses/".concat(e),DELETE_ADDRESS:e=>"/public/user/addresses/".concat(e),WISHLIST:"/public/user/wishlist",ADD_TO_WISHLIST:"/public/user/wishlist/add",REMOVE_FROM_WISHLIST:"/public/user/wishlist/remove"},SEARCH:{PRODUCTS:"/search/products",SUGGESTIONS:"/search/suggestions"},NEWSLETTER:{SUBSCRIBE:"/newsletter/subscribe"},CONTACTS:{SUBMIT:"/contacts"},ANALYTICS:{TRACK:"/analytics/track"},POSTS:{LIST:"/public/posts",DETAIL:e=>"/public/posts/".concat(e),RELATED:e=>"/public/posts/".concat(e,"/related")},ABOUT:{SECTIONS:"/about-sections",SECTION_BY_KEY:e=>"/about-sections/key/".concat(e)},TRACKING:{ACTIVE_SCRIPTS:"/tracking-scripts/active"}}},653:function(e,t,r){r.d(t,{t:function(){return n}});var a=r(9625),o=r(6885),s=r(3414);let n=(0,a.Ue)()((0,o.tJ)(e=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,setAuth:(t,r,a)=>{localStorage.setItem("accessToken",r),localStorage.setItem("refreshToken",a),e({user:t,accessToken:r,refreshToken:a,isAuthenticated:!0})},logout:async()=>{try{await (0,s.kS)()}catch(e){console.error("Logout API error:",e)}localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})},updateUser:t=>e(e=>({user:e.user?{...e.user,...t}:null}))}),{name:"auth-storage"}))}}]);