(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7017],{4568:function(e,a,r){Promise.resolve().then(r.bind(r,9002))},9002:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return x},dynamic:function(){return N}});var l=r(7437),t=r(2265),s=r(9501),n=r(7996),i=r(2709),o=r(7194),d=r(3276),m=r(653),c=r(3405),u=r(2780);let h=e=>{if(e.firstName||e.lastName)return{firstName:e.firstName||"",lastName:e.lastName||""};if(e.name){let a=e.name.trim().split(/\s+/);if(a.length>=2)return{lastName:a[0],firstName:a.slice(1).join(" ")};if(1===a.length)return{firstName:a[0],lastName:""}}return{firstName:"",lastName:""}},f=async()=>{try{let e=(await c.Z.get(u.P.USER.PROFILE)).data.data,{firstName:a,lastName:r}=h(e);return!e.name||e.firstName||e.lastName||console.warn('[getUserProfile] ⚠️ Backend should return "firstName" and "lastName" instead of "name" for consistency with database schema'),{id:e.id,email:e.email,firstName:a,lastName:r,phone:e.phone||void 0,avatar:e.avatar,role:e.role,emailVerified:e.emailVerified,createdAt:e.createdAt,updatedAt:e.updatedAt}}catch(t){var e,a,r,l;throw console.error("[getUserProfile] Error:",t),console.error("[getUserProfile] Error details:",{message:null==t?void 0:t.message,response:null==t?void 0:null===(e=t.response)||void 0===e?void 0:e.data,status:null==t?void 0:null===(a=t.response)||void 0===a?void 0:a.status,url:null==t?void 0:null===(r=t.config)||void 0===r?void 0:r.url,baseURL:null==t?void 0:null===(l=t.config)||void 0===l?void 0:l.baseURL}),t}},p=async e=>{try{let a={email:e.email};e.name?a.name=e.name:(e.firstName||e.lastName)&&(a.firstName=e.firstName,a.lastName=e.lastName),void 0!==e.phone&&null!==e.phone?a.phone=e.phone.trim()||null:""===e.phone&&(a.phone=null),void 0!==e.avatar&&(a.avatar=e.avatar);let r=(await c.Z.put(u.P.USER.UPDATE_PROFILE,a)).data.data,{firstName:l,lastName:t}=h(r);r.name&&!r.firstName&&r.lastName;let s=r.phone;return!s&&e.phone?(console.warn("[updateUserProfile] ⚠️ Backend did not return phone, using phone from request:",e.phone),s=e.phone.trim()||void 0):!s&&a.phone&&(console.warn("[updateUserProfile] ⚠️ Backend did not return phone, using phone from request payload:",a.phone),s=null===a.phone?void 0:a.phone),{id:r.id,email:r.email,firstName:l,lastName:t,phone:s||void 0,avatar:r.avatar,role:r.role,emailVerified:r.emailVerified,createdAt:r.createdAt,updatedAt:r.updatedAt}}catch(e){var a,r,l,t,s;throw console.error("[updateUserProfile] Error:",e),console.error("[updateUserProfile] Error details:",{message:null==e?void 0:e.message,response:null==e?void 0:null===(a=e.response)||void 0===a?void 0:a.data,status:null==e?void 0:null===(r=e.response)||void 0===r?void 0:r.status,url:null==e?void 0:null===(l=e.config)||void 0===l?void 0:l.url,baseURL:null==e?void 0:null===(t=e.config)||void 0===t?void 0:t.baseURL,requestData:null==e?void 0:null===(s=e.config)||void 0===s?void 0:s.data}),e}};var v=r(9064);let N="force-dynamic";function x(){var e,a,r,c,u;let{user:h,updateUser:N}=(0,m.t)(),[x,g]=(0,t.useState)(!1),[b,y]=(0,t.useState)(!1),{register:j,handleSubmit:w,reset:P,formState:{errors:k}}=(0,s.cI)({defaultValues:{fullName:(null==h?void 0:h.lastName)&&(null==h?void 0:h.firstName)?"".concat(h.lastName," ").concat(h.firstName).trim():(null==h?void 0:h.firstName)||(null==h?void 0:h.lastName)||"",email:(null==h?void 0:h.email)||"",phone:""}});(0,t.useEffect)(()=>{let e=!0;return(async()=>{g(!0);try{let a=await f();if(!e)return;let r=a.lastName&&a.firstName?"".concat(a.lastName," ").concat(a.firstName).trim():a.firstName||a.lastName||"",l=a.phone||(null==h?void 0:h.phone)||"";P({fullName:r,email:a.email||"",phone:l}),h&&h.firstName===a.firstName&&h.lastName===a.lastName&&h.email===a.email&&h.phone===l||N({firstName:a.firstName,lastName:a.lastName,email:a.email,phone:l})}catch(t){var a,r,l;if(console.error("[Profile] Failed to fetch profile:",t),console.error("[Profile] Error details:",{message:null==t?void 0:t.message,response:null==t?void 0:null===(a=t.response)||void 0===a?void 0:a.data,status:null==t?void 0:null===(r=t.response)||void 0===r?void 0:r.status}),!e)return;(null===(l=t.response)||void 0===l?void 0:l.status)===401?v.ZP.error("Vui l\xf2ng đăng nhập để xem th\xf4ng tin"):h?P({fullName:h.lastName&&h.firstName?"".concat(h.lastName," ").concat(h.firstName).trim():h.firstName||h.lastName||"",email:h.email||"",phone:""}):console.warn("[Profile] No user data available, form will be empty")}finally{e&&g(!1)}})(),()=>{e=!1}},[]);let E=async e=>{y(!0);try{let a={name:e.fullName.trim(),email:e.email,phone:e.phone?e.phone.trim():void 0},r=await p(a);N({firstName:r.firstName,lastName:r.lastName,email:r.email,phone:r.phone});let l=r.lastName&&r.firstName?"".concat(r.lastName," ").concat(r.firstName).trim():r.firstName||r.lastName||"";P({fullName:l,email:r.email,phone:r.phone||""}),v.ZP.success("Cập nhật th\xf4ng tin th\xe0nh c\xf4ng!")}catch(i){var a,r,l,t,s,n;console.error("[Profile] ========== PROFILE UPDATE ERROR =========="),console.error("[Profile] Update profile error:",i),console.error("[Profile] Error details:",{message:null==i?void 0:i.message,response:null==i?void 0:null===(a=i.response)||void 0===a?void 0:a.data,status:null==i?void 0:null===(r=i.response)||void 0===r?void 0:r.status,url:null==i?void 0:null===(l=i.config)||void 0===l?void 0:l.url,baseURL:null==i?void 0:null===(t=i.config)||void 0===t?void 0:t.baseURL,requestData:null==i?void 0:null===(s=i.config)||void 0===s?void 0:s.data});let e="Cập nhật thất bại. Vui l\xf2ng thử lại.";(null==i?void 0:null===(n=i.response)||void 0===n?void 0:n.data)?i.response.data.message?e=i.response.data.message:i.response.data.error?e=i.response.data.error.message||i.response.data.error:"string"==typeof i.response.data&&(e=i.response.data):(null==i?void 0:i.message)&&(e=i.message),v.ZP.error(e)}finally{y(!1)}};return x?(0,l.jsx)("div",{className:"card p-6",children:(0,l.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,l.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-brand-purple-600 border-t-transparent"})})}):(0,l.jsxs)("div",{children:[(0,l.jsx)(d.Z,{items:[{label:"Trang chủ",href:"/"},{label:"T\xe0i khoản",href:"/account"},{label:"Hồ sơ",href:"/account/profile"}],className:"mb-6"}),(0,l.jsxs)("div",{className:"card p-6",children:[(0,l.jsx)("h1",{className:"mb-6 text-2xl font-bold text-gray-900",children:"Th\xf4ng tin c\xe1 nh\xe2n"}),(0,l.jsxs)("form",{onSubmit:w(E),className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-6 border-b border-gray-200 pb-6",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{className:"h-24 w-24 overflow-hidden rounded-full bg-gray-200",children:(null==h?void 0:h.lastName)||(null==h?void 0:h.firstName)?(0,l.jsxs)("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-purple-500 to-pink-500 text-2xl font-bold text-white",children:[(null===(e=h.lastName)||void 0===e?void 0:e[0])||"",(null===(a=h.firstName)||void 0===a?void 0:a[0])||""]}):(0,l.jsx)(n.fzv,{className:"m-auto h-12 w-12 text-gray-400"})}),(0,l.jsx)("button",{type:"button",className:"absolute bottom-0 right-0 flex h-8 w-8 items-center justify-center rounded-full bg-brand-purple-600 text-white shadow-lg transition-colors hover:bg-brand-purple-700",children:(0,l.jsx)(n.tBf,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"font-semibold text-gray-900",children:[null==h?void 0:h.lastName," ",null==h?void 0:h.firstName]}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:null==h?void 0:h.email}),(0,l.jsx)("button",{type:"button",className:"mt-2 text-sm text-brand-purple-600 hover:text-brand-purple-700",children:"Thay đổi ảnh đại diện"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[(0,l.jsx)(o.Z,{label:"Họ v\xe0 t\xean",type:"text",placeholder:"Nguyễn Văn A",leftIcon:(0,l.jsx)(n.fzv,{className:"h-5 w-5"}),error:null===(r=k.fullName)||void 0===r?void 0:r.message,required:!0,...j("fullName",{required:"Họ v\xe0 t\xean l\xe0 bắt buộc",minLength:{value:2,message:"Họ v\xe0 t\xean phải c\xf3 \xedt nhất 2 k\xfd tự"}})}),(0,l.jsx)(o.Z,{label:"Email",type:"email",placeholder:"your.email@example.com",leftIcon:(0,l.jsx)(n.Imn,{className:"h-5 w-5"}),error:null===(c=k.email)||void 0===c?void 0:c.message,required:!0,disabled:!0,...j("email",{required:"Email l\xe0 bắt buộc",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Email kh\xf4ng hợp lệ"}})}),(0,l.jsx)(o.Z,{label:"Số điện thoại",type:"tel",placeholder:"0901234567",leftIcon:(0,l.jsx)(n.tUt,{className:"h-5 w-5"}),error:null===(u=k.phone)||void 0===u?void 0:u.message,...j("phone",{pattern:{value:/^[0-9]{10,11}$/,message:"Số điện thoại kh\xf4ng hợp lệ"}})})]}),(0,l.jsxs)("div",{className:"border-t border-gray-200 pt-6",children:[(0,l.jsx)("h3",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Đổi mật khẩu"}),(0,l.jsxs)("p",{className:"mb-4 text-sm text-gray-600",children:["Để đổi mật khẩu, vui l\xf2ng"," ",(0,l.jsx)("a",{href:"/forgot-password",className:"text-brand-purple-600 hover:underline",children:"click v\xe0o đ\xe2y"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-4 border-t border-gray-200 pt-6",children:[(0,l.jsx)(i.Z,{href:"/account",variant:"outline",children:"Hủy"}),(0,l.jsxs)(i.Z,{type:"submit",isLoading:b,disabled:b,children:[(0,l.jsx)(n.mW3,{className:"mr-2 h-4 w-4"}),"Lưu thay đổi"]})]})]})]})]})}},3276:function(e,a,r){"use strict";r.d(a,{Z:function(){return s}});var l=r(7437),t=r(7648);function s(e){let{items:a,className:r=""}=e;return(0,l.jsx)("nav",{className:"flex ".concat(r),"aria-label":"Breadcrumb",children:(0,l.jsx)("ol",{className:"flex flex-wrap items-center gap-x-2 gap-y-1 text-sm",children:a.map((e,r)=>(0,l.jsxs)("li",{className:"flex items-center",children:[r>0&&(0,l.jsx)("svg",{className:"mx-2 h-4 w-4 shrink-0 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),e.href&&r<a.length-1?(0,l.jsx)(t.default,{href:e.href,className:"break-words text-gray-600 hover:text-brand-purple-600",children:e.label}):(0,l.jsx)("span",{className:"break-words font-medium text-gray-900",children:e.label})]},r))})})}},2709:function(e,a,r){"use strict";r.d(a,{Z:function(){return n}});var l=r(7437),t=r(7648),s=r(6857);function n(e){let{children:a,variant:r="primary",size:n="md",isLoading:i=!1,fullWidth:o=!1,className:d,disabled:m,href:c,...u}=e,h=(0,s.cn)("btn",{primary:"btn-primary",secondary:"btn-secondary",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-gray-500",ghost:"bg-transparent text-brand-purple-600 hover:bg-brand-purple-50 focus:ring-brand-purple-500",danger:"bg-error text-white hover:bg-[#98131b] focus:ring-error"}[r],{sm:"btn-sm",md:"btn-md",lg:"btn-lg"}[n],o&&"w-full",(m||i)&&"opacity-50 cursor-not-allowed",d),f=i?(0,l.jsxs)("div",{className:"flex items-center justify-center",children:[(0,l.jsxs)("svg",{className:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Đang tải..."]}):a;return c?(0,l.jsx)(t.default,{href:c,legacyBehavior:!0,passHref:!0,children:(0,l.jsx)("a",{className:h,children:f})}):(0,l.jsx)("button",{className:h,disabled:m||i,...u,children:f})}},7194:function(e,a,r){"use strict";var l=r(7437),t=r(2265),s=r(6857);let n=(0,t.forwardRef)((e,a)=>{let{label:r,error:n,helperText:i,leftIcon:o,rightIcon:d,className:m,id:c,required:u,...h}=e,f=(0,t.useId)(),p=null!=c?c:f;return(0,l.jsxs)("div",{className:"w-full",children:[r&&(0,l.jsxs)("label",{htmlFor:p,className:"mb-1.5 block text-sm font-medium text-gray-700",children:[r,u&&(0,l.jsx)("span",{className:"ml-1 text-error",children:"*"})]}),(0,l.jsxs)("div",{className:"relative",children:[o&&(0,l.jsx)("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400",children:o}),(0,l.jsx)("input",{ref:a,id:p,className:(0,s.cn)("input",n&&"input-error",o&&"pl-10",d&&"pr-10",m),required:u,...h}),d&&(0,l.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400",children:d})]}),n&&(0,l.jsx)("p",{className:"mt-1.5 text-sm text-error",children:n}),i&&!n&&(0,l.jsx)("p",{className:"mt-1.5 text-sm text-gray-500",children:i})]})});n.displayName="Input",a.Z=n},6857:function(e,a,r){"use strict";r.d(a,{cn:function(){return t}});var l=r(1994);function t(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return(0,l.W)(a)}}},function(e){e.O(0,[9956,2972,9064,9502,5883,8036,653,2971,2117,1744],function(){return e(e.s=4568)}),_N_E=e.O()}]);