(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6351],{3563:function(e,t,r){Promise.resolve().then(r.bind(r,8977))},8977:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m},dynamic:function(){return d}});var n=r(7437),a=r(2265),s=r(9376),c=r(7648),l=r(2709),i=r(7996),u=r(9778),o=r(2154);let d="force-dynamic";function h(){let e=(0,s.useSearchParams)();(0,s.useRouter)();let t=(0,o.x)(e=>e.clearCart),[r,d]=(0,a.useState)("loading"),[h,m]=(0,a.useState)(""),[f,g]=(0,a.useState)(""),[x,p]=(0,a.useState)(""),v=(0,a.useRef)(!0),y=(0,a.useRef)("loading"),b=(0,a.useRef)(null),j=(0,a.useRef)(null),N=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{y.current=r},[r]),(0,a.useEffect)(()=>{let r=(null==e?void 0:e.get("apptransid"))||(null==e?void 0:e.get("app_trans_id"));null==e||e.get("status");let n=r||"";if(n||(n=sessionStorage.getItem("zalopayAppTransId")||""),!n){console.error("[Checkout Result] No app_trans_id found in URL or sessionStorage"),d("failed"),p("Kh\xf4ng t\xecm thấy th\xf4ng tin giao dịch. Vui l\xf2ng li\xean hệ hỗ trợ."),v.current=!1;return}g(n);{let e=sessionStorage.getItem("lastOrder");if(e)try{let t=JSON.parse(e);t.order_number&&m(t.order_number)}catch(e){console.error("Failed to parse order data:",e)}}let a=async()=>{if(v.current)try{let e=await (0,u.s)(n);if(e.success&&e.data){let r=e.data.return_code;1===r?(v.current=!1,d("success"),p("Thanh to\xe1n th\xe0nh c\xf4ng! Cảm ơn bạn đ\xe3 mua sắm."),N.current||(t(),N.current=!0),sessionStorage.removeItem("zalopayAppTransId"),sessionStorage.removeItem("lastOrder"),b.current&&(clearInterval(b.current),b.current=null),j.current&&(clearTimeout(j.current),j.current=null)):-1===e.data.sub_return_code||1!==r?(v.current=!1,d("failed"),p(e.data.return_message||e.data.sub_return_message||"Thanh to\xe1n thất bại. Vui l\xf2ng thử lại."),b.current&&(clearInterval(b.current),b.current=null),j.current&&(clearTimeout(j.current),j.current=null)):(d("pending"),p("Đang chờ x\xe1c nhận thanh to\xe1n..."))}else d("pending"),p("Đang kiểm tra trạng th\xe1i thanh to\xe1n...")}catch(t){var e,r;console.error("[Checkout Result] Query error:",t),console.error("[Checkout Result] Error details:",{message:t.message,response:null===(e=t.response)||void 0===e?void 0:e.data,status:null===(r=t.response)||void 0===r?void 0:r.status}),d("pending"),p("Đang kiểm tra trạng th\xe1i thanh to\xe1n...")}};return a(),b.current=setInterval(()=>{v.current&&"pending"===y.current?a():b.current&&(clearInterval(b.current),b.current=null)},3e3),j.current=setTimeout(()=>{"pending"===y.current&&v.current&&(v.current=!1,d("failed"),p("Kh\xf4ng thể x\xe1c nhận thanh to\xe1n. Vui l\xf2ng tra cứu đơn h\xe0ng hoặc li\xean hệ hỗ trợ.")),b.current&&(clearInterval(b.current),b.current=null)},6e4),()=>{b.current&&(clearInterval(b.current),b.current=null),j.current&&(clearTimeout(j.current),j.current=null)}},[e]),(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-16",children:(0,n.jsx)("div",{className:"container-custom",children:(0,n.jsxs)("div",{className:"mx-auto max-w-2xl",children:[(0,n.jsxs)("div",{className:"mb-8 text-center",children:["loading"===r||"pending"===r?(0,n.jsx)("div",{className:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-blue-100",children:(0,n.jsx)(i.dAq,{className:"h-12 w-12 animate-spin text-blue-600"})}):"success"===r?(0,n.jsx)("div",{className:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-green-100",children:(0,n.jsx)(i._rq,{className:"h-12 w-12 text-green-600"})}):(0,n.jsx)("div",{className:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-red-100",children:(0,n.jsx)(i.$Rx,{className:"h-12 w-12 text-red-600"})}),(0,n.jsx)("h1",{className:"mb-2 text-3xl font-bold text-gray-900",children:"loading"===r||"pending"===r?"Đang xử l\xfd thanh to\xe1n...":"success"===r?"Thanh to\xe1n th\xe0nh c\xf4ng!":"Thanh to\xe1n thất bại"}),(0,n.jsx)("p",{className:"text-lg text-gray-600",children:x||"Vui l\xf2ng chờ trong gi\xe2y l\xe1t..."})]}),h&&(0,n.jsxs)("div",{className:"mb-8 rounded-lg bg-white p-8 shadow-md",children:[(0,n.jsxs)("div",{className:"mb-6 border-b border-gray-200 pb-6",children:[(0,n.jsx)("h2",{className:"mb-2 text-xl font-bold text-gray-900",children:"M\xe3 đơn h\xe0ng"}),(0,n.jsx)("p",{className:"text-2xl font-mono font-semibold text-brand-purple-600",children:h})]}),"success"===r&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-start gap-4",children:[(0,n.jsx)("div",{className:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-purple-100",children:(0,n.jsx)(i.zFh,{className:"h-6 w-6 text-purple-600"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-gray-900",children:"Đơn h\xe0ng đ\xe3 được x\xe1c nhận"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Đơn h\xe0ng của bạn đ\xe3 được thanh to\xe1n th\xe0nh c\xf4ng v\xe0 đang được xử l\xfd."})]})]}),(0,n.jsxs)("div",{className:"flex items-start gap-4",children:[(0,n.jsx)("div",{className:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-green-100",children:(0,n.jsx)(i.tUt,{className:"h-6 w-6 text-green-600"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-gray-900",children:"Tra cứu đơn h\xe0ng"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Sử dụng số điện thoại đ\xe3 đăng k\xfd để tra cứu trạng th\xe1i đơn h\xe0ng."})]})]})]})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row",children:["success"===r&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.default,{href:"/order-lookup",className:"flex-1",children:(0,n.jsx)(l.Z,{variant:"outline",fullWidth:!0,children:"Tra cứu đơn h\xe0ng"})}),(0,n.jsx)(c.default,{href:"/products",className:"flex-1",children:(0,n.jsx)(l.Z,{fullWidth:!0,children:"Tiếp tục mua sắm"})})]}),"failed"===r&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.default,{href:"/order-lookup",className:"flex-1",children:(0,n.jsx)(l.Z,{variant:"outline",fullWidth:!0,children:"Tra cứu đơn h\xe0ng"})}),(0,n.jsx)(c.default,{href:"/checkout",className:"flex-1",children:(0,n.jsx)(l.Z,{fullWidth:!0,children:"Thử lại thanh to\xe1n"})})]}),("loading"===r||"pending"===r)&&(0,n.jsx)(c.default,{href:"/order-lookup",className:"flex-1",children:(0,n.jsx)(l.Z,{variant:"outline",fullWidth:!0,children:"Tra cứu đơn h\xe0ng"})})]}),(0,n.jsx)("div",{className:"mt-8 text-center text-sm text-gray-600",children:(0,n.jsxs)("p",{children:["Cần hỗ trợ?"," ",(0,n.jsx)(c.default,{href:"/contact",className:"text-brand-purple-600 hover:underline",children:"Li\xean hệ đội ngũ hỗ trợ"})]})})]})})})}function m(){return(0,n.jsx)(a.Suspense,{fallback:(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-16",children:(0,n.jsx)("div",{className:"container-custom",children:(0,n.jsxs)("div",{className:"mx-auto max-w-2xl text-center",children:[(0,n.jsx)("div",{className:"mb-4 text-5xl animate-pulse",children:"\uD83D\uDCB3"}),(0,n.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Đang xử l\xfd..."})]})})}),children:(0,n.jsx)(h,{})})}},2709:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var n=r(7437),a=r(7648),s=r(6857);function c(e){let{children:t,variant:r="primary",size:c="md",isLoading:l=!1,fullWidth:i=!1,className:u,disabled:o,href:d,...h}=e,m=(0,s.cn)("btn",{primary:"btn-primary",secondary:"btn-secondary",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-gray-500",ghost:"bg-transparent text-brand-purple-600 hover:bg-brand-purple-50 focus:ring-brand-purple-500",danger:"bg-error text-white hover:bg-[#98131b] focus:ring-error"}[r],{sm:"btn-sm",md:"btn-md",lg:"btn-lg"}[c],i&&"w-full",(o||l)&&"opacity-50 cursor-not-allowed",u),f=l?(0,n.jsxs)("div",{className:"flex items-center justify-center",children:[(0,n.jsxs)("svg",{className:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Đang tải..."]}):t;return d?(0,n.jsx)(a.default,{href:d,legacyBehavior:!0,passHref:!0,children:(0,n.jsx)("a",{className:m,children:f})}):(0,n.jsx)("button",{className:m,disabled:o||l,...h,children:f})}},1971:function(e,t,r){"use strict";r.d(t,{f8:function(){return d},kG:function(){return u},uD:function(){return h}}),r(257);let n="/api",a=e=>e?e.replace(/\/+$/,""):"",s=e=>e?e.startsWith("/")?e:"/".concat(e):"",c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=a(e);return t?"".concat(r).concat(s(t)):r},l=()=>{let e=a("https://ecommerce-api.banyco.vn/api");if(e)return e.endsWith("/api")?e:c(e,n);let t="ecommerce-api.banyco.vn";if(t){let e=window.location.protocol;return"".concat(e,"//").concat(t).concat(n)}{let{protocol:e,hostname:t}=window.location;return c("".concat(e,"//").concat(t).concat(":".concat("443")),n)}},i=e=>a(e).replace(/\/api$/,""),u=()=>l(),o=()=>i(l()),d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c(l(),e)},h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c(o(),e)}},3405:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var n=r(3464),a=r(1971);let s=n.Z.create({baseURL:(0,a.kG)(),timeout:3e4,headers:{"Content-Type":"application/json"}});function c(e){if(n.Z.isAxiosError(e)){if(e.response){let t=e.response.data;return(null==t?void 0:t.code)==="INSUFFICIENT_STOCK"?'Sản phẩm "'.concat(t.productName,'" kh\xf4ng đủ số lượng. C\xf2n lại: ').concat(t.availableStock,", Bạn y\xeau cầu: ").concat(t.requestedQuantity):(null==t?void 0:t.error)||(null==t?void 0:t.message)||"Đ\xe3 xảy ra lỗi khi xử l\xfd y\xeau cầu"}if(e.request)return"Kh\xf4ng c\xf3 phản hồi từ server. Vui l\xf2ng kiểm tra kết nối của bạn."}return"Đ\xe3 xảy ra lỗi kh\xf4ng mong muốn"}s.interceptors.request.use(e=>{{let t=localStorage.getItem("accessToken");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!r._retry){r._retry=!0;try{let e=localStorage.getItem("refreshToken");if(e){let{accessToken:t}=(await n.Z.post("".concat((0,a.kG)(),"/public/auth/refresh"),{refreshToken:e})).data.data;return localStorage.setItem("accessToken",t),r.headers&&(r.headers.Authorization="Bearer ".concat(t)),s(r)}}catch(e){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login",Promise.reject(e)}}return Promise.reject(e)}),t.Z=s},9778:function(e,t,r){"use strict";r.d(t,{n:function(){return s},s:function(){return c}});var n=r(3405),a=r(1971);let s=async e=>{try{return(await n.Z.post((0,a.f8)("payments/zalopay/create"),e)).data}catch(e){throw console.error("[Payments API] Create ZaloPay order error:",e),e}},c=async e=>{try{return(await n.Z.get((0,a.f8)("payments/zalopay/query/".concat(e)))).data}catch(e){throw console.error("[Payments API] Query ZaloPay order error:",e),e}}},2154:function(e,t,r){"use strict";r.d(t,{x:function(){return s}});var n=r(9625),a=r(6885);let s=(0,n.Ue)()((0,a.tJ)((e,t)=>({items:[],addItem:t=>e(e=>{if(t.quantity<=0)return e;let r=e.items.findIndex(e=>e.productId===t.productId&&e.variantId===t.variantId);if(r>-1){let n=[...e.items];return n[r].quantity+=t.quantity,{items:n}}return{items:[...e.items,t]}}),removeItem:(t,r)=>e(e=>({items:e.items.filter(e=>!(e.productId===t&&e.variantId===r))})),updateQuantity:(t,r,n)=>e(e=>r<=0?{items:e.items.filter(e=>!(e.productId===t&&e.variantId===n))}:{items:e.items.map(e=>e.productId===t&&e.variantId===n?{...e,quantity:r}:e)}),clearCart:()=>e({items:[]}),getTotalItems:()=>t().items.reduce((e,t)=>e+t.quantity,0),getSubtotal:()=>t().items.reduce((e,t)=>e+t.price*t.quantity,0),getTotalPrice:()=>t().getSubtotal()}),{name:"cart-storage"}))},6857:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var n=r(1994);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.W)(t)}},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},1994:function(e,t,r){"use strict";function n(){for(var e,t,r=0,n="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=function e(t){var r,n,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t){if(Array.isArray(t)){var s=t.length;for(r=0;r<s;r++)t[r]&&(n=e(t[r]))&&(a&&(a+=" "),a+=n)}else for(n in t)t[n]&&(a&&(a+=" "),a+=n)}return a}(e))&&(n&&(n+=" "),n+=t);return n}r.d(t,{W:function(){return n}})}},function(e){e.O(0,[9956,2972,9502,5883,2971,2117,1744],function(){return e(e.s=3563)}),_N_E=e.O()}]);